---
// src/components/ProcessStep.astro v1.0 (Server-Mode & UX optimiert)
// Process Step Component - Accessibility & Business optimiert

// âœ… WICHTIG: Komponenten brauchen kein prerender - automatisch statisch im Server-Mode

interface Props {
  number: string;
  title: string;
  description: string;
  delay?: number;
  variant?: "default" | "compact" | "detailed";
  isActive?: boolean; // FÃ¼r aktuelle Phase
  isCompleted?: boolean; // FÃ¼r abgeschlossene Schritte
  duration?: string; // Zeitangabe (z.B. "2-4 Wochen")
  icon?: string; // Optional icon path statt Number
  connectLine?: boolean; // Verbindungslinie zum nÃ¤chsten Schritt
}

const { 
  number, 
  title, 
  description, 
  delay = 100,
  variant = "default",
  isActive = false,
  isCompleted = false,
  duration,
  icon,
  connectLine = false
} = Astro.props;

// Variant-spezifische Klassen
const variantClasses = {
  default: "bg-light-darker dark:bg-dark-lighter rounded-lg p-5",
  compact: "bg-light-darker dark:bg-dark-lighter rounded-lg p-4",
  detailed: "bg-white dark:bg-dark rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700"
};

// Status-abhÃ¤ngige Styles
const getNumberStyles = () => {
  if (isCompleted) {
    return "bg-green-500 text-white";
  } else if (isActive) {
    return "bg-primary-gold text-white shadow-lg shadow-primary-gold/30 animate-pulse-subtle";
  } else {
    return "bg-primary-gold text-white";
  }
};

// GrÃ¶ÃŸen basierend auf Variante
const getSizes = () => {
  switch (variant) {
    case "compact":
      return { circle: "w-12 h-12", text: "text-lg", spacing: "mb-3" };
    case "detailed":
      return { circle: "w-20 h-20", text: "text-2xl", spacing: "mb-6" };
    default:
      return { circle: "w-16 h-16", text: "text-xl", spacing: "mb-4" };
  }
};

const sizes = getSizes();
const numberStyles = getNumberStyles();
const contentClasses = variantClasses[variant];

// SEO-optimierte Step-ID
const stepId = `process-step-${number}`;

console.log(`ðŸ“ˆ ProcessStep v1.0 loaded - Number: ${number}, Title: ${title}, Active: ${isActive}`);
---

<article 
  class="relative z-10 group"
  data-aos="fade-up" 
  data-aos-delay={delay}
  id={stepId}
  itemscope
  itemtype="https://schema.org/HowToStep"
>
  <!-- Verbindungslinie (optional) -->
  {connectLine && (
    <div class="absolute top-8 left-1/2 w-0.5 h-20 bg-primary-gold/30 transform -translate-x-1/2 z-0 hidden md:block" aria-hidden="true"></div>
  )}
  
  <div class="flex flex-col items-center relative">
    <!-- Step Number/Icon Circle -->
    <div class={`${sizes.circle} rounded-full ${numberStyles} flex items-center justify-center ${sizes.text} font-bold ${sizes.spacing} transition-all duration-300 group-hover:scale-110 group-hover:shadow-xl relative z-10`}>
      {icon ? (
        <!-- Custom Icon -->
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          viewBox="0 0 24 24" 
          fill="currentColor" 
          class="w-8 h-8"
          aria-label={`Schritt ${number} Icon`}
        >
          <path d={icon} />
        </svg>
      ) : (
        <!-- Number or Check for completed -->
        <>
          {isCompleted ? (
            <svg 
              xmlns="http://www.w3.org/2000/svg" 
              viewBox="0 0 24 24" 
              fill="currentColor" 
              class="w-8 h-8"
              aria-label="Schritt abgeschlossen"
            >
              <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z" clip-rule="evenodd" />
            </svg>
          ) : (
            <span itemprop="position">{number}</span>
          )}
        </>
      )}
      
      <!-- Aktiver Step - Pulsing Ring -->
      {isActive && (
        <div class="absolute inset-0 rounded-full border-2 border-primary-gold animate-ping opacity-75" aria-hidden="true"></div>
      )}
    </div>
    
    <!-- Step Content -->
    <div class="w-full max-w-sm">
      <!-- Title -->
      <h3 class={`font-semibold text-text-dark dark:text-text-light mb-2 md:mb-3 text-center group-hover:text-primary-gold transition-colors duration-300 ${
        variant === "compact" ? "text-lg" : variant === "detailed" ? "text-2xl" : "text-xl"
      }`}>
        <span itemprop="name">{title}</span>
        {isActive && (
          <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-gold text-white">
            Aktuell
          </span>
        )}
      </h3>
      
      <!-- Duration (if provided) -->
      {duration && (
        <div class="text-center mb-3">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-gold/10 text-primary-gold">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" />
            </svg>
            {duration}
          </span>
        </div>
      )}
      
      <!-- Description Box -->
      <div class={`${contentClasses} text-center transition-all duration-300 group-hover:shadow-md ${
        isActive ? "ring-2 ring-primary-gold/20" : ""
      }`}>
        <p class={`text-text-muted leading-relaxed ${variant === "compact" ? "text-sm" : "text-base"}`}>
          <span itemprop="text">{description}</span>
        </p>
        
        <!-- Progress Indicator fÃ¼r aktive Steps -->
        {isActive && (
          <div class="mt-3 pt-3 border-t border-primary-gold/20">
            <div class="flex items-center justify-center space-x-1">
              <div class="w-2 h-2 bg-primary-gold rounded-full animate-bounce"></div>
              <div class="w-2 h-2 bg-primary-gold rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
              <div class="w-2 h-2 bg-primary-gold rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
            <p class="text-xs text-primary-gold mt-1 font-medium">In Bearbeitung</p>
          </div>
        )}
        
        <!-- Completion Indicator -->
        {isCompleted && (
          <div class="mt-3 pt-3 border-t border-green-500/20">
            <div class="flex items-center justify-center text-green-500">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
              </svg>
              <span class="text-xs font-medium">Abgeschlossen</span>
            </div>
          </div>
        )}
      </div>
    </div>
    
    <!-- Schema.org zusÃ¤tzliche Daten (versteckt) -->
    <div class="sr-only">
      <span itemprop="url">#{stepId}</span>
    </div>
  </div>
</article>

<style>
  /* Subtle Pulse Animation fÃ¼r aktive Schritte */
  @keyframes pulse-subtle {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.8;
    }
  }
  
  .animate-pulse-subtle {
    animation: pulse-subtle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  
  /* Hover Effekte */
  .group:hover .bg-light-darker,
  .group:hover .bg-dark-lighter {
    background-color: rgba(212, 175, 55, 0.05);
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .max-w-sm {
      max-width: 100%;
    }
    
    /* Kleinere Circles auf Mobile */
    .w-20 {
      width: 4rem !important;
      height: 4rem !important;
    }
    
    .w-16 {
      width: 3.5rem !important;
      height: 3.5rem !important;
    }
  }
  
  /* Accessibility - Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .group-hover\\:scale-110 {
      transform: none !important;
    }
    
    .animate-pulse-subtle,
    .animate-ping,
    .animate-bounce {
      animation: none !important;
    }
  }
  
  /* Dark Mode Optimierungen */
  @media (prefers-color-scheme: dark) {
    .bg-white {
      border-color: rgba(212, 175, 55, 0.1);
    }
  }
  
  /* Focus States */
  article:focus-within {
    outline: 2px solid #D2AE6C;
    outline-offset: 2px;
    border-radius: 0.5rem;
  }
  
  /* Print Styles */
  @media print {
    article {
      break-inside: avoid;
    }
    
    .animate-pulse-subtle,
    .animate-ping,
    .animate-bounce {
      animation: none;
    }
    
    .group-hover\\:scale-110 {
      transform: none;
    }
  }
  
  /* Screen Reader Only Content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Footer version info */
  .footer-version::after {
    content: "ProcessStep v1.0 - Server-Mode & UX optimiert";
  }
</style>