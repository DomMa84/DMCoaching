---
// src/components/CookieConsent.astro v1.2.1 (SYNTAX FIXED)
// CookieConsent - Build-sichere Version mit korrekter Syntax

interface Props {
  position?: 'bottom' | 'top' | 'bottom-right' | 'bottom-left';
  variant?: 'minimal' | 'detailed' | 'compact';
  showManageButton?: boolean;
  autoShow?: boolean;
  cookieLifetime?: number;
}

const {
  position = 'bottom',
  variant = 'detailed',
  showManageButton = false,
  autoShow = true,
  cookieLifetime = 180
} = Astro.props;

const bannerId = `cookie-consent-${Math.random().toString(36).substr(2, 9)}`;

console.log(`üç™ CookieConsent v1.2.1 loaded - ${variant} variant - SYNTAX FIXED`);
---

<div 
  id={bannerId}
  class="cookie-banner fixed bottom-4 left-4 right-4 max-w-4xl mx-auto p-4 md:p-6 bg-white dark:bg-gray-800 shadow-2xl rounded-lg z-50 transform translate-y-full opacity-0 transition-all duration-500"
>
  <div class="flex items-start justify-between mb-4">
    <div class="flex items-center space-x-3 flex-1">
      <div class="flex-shrink-0 w-8 h-8 bg-gold bg-opacity-10 rounded-full flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-gold">
          <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM9 7.5A1.5 1.5 0 1010.5 9 1.5 1.5 0 009 7.5zm1.5 8.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM15 12a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" clip-rule="evenodd" />
        </svg>
      </div>
      
      <div class="flex-1">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
          Wir verwenden Cookies
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          Wir verwenden Cookies, um Ihnen die beste Online-Erfahrung zu bieten. Mit Ihrer Zustimmung akzeptieren Sie die Verwendung von Cookies.
          <a href="/datenschutz" class="text-gold hover:underline ml-1">
            Datenschutzrichtlinie
          </a>
        </p>
      </div>
    </div>
    
    <button 
      class="flex-shrink-0 ml-4 p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
      data-action="decline"
    >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
        <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
      </svg>
    </button>
  </div>
  
  <div class="flex flex-wrap gap-3">
    <button 
      class="bg-gold hover:bg-gold-dark text-white font-medium px-4 py-2 rounded-md transition-colors duration-300"
      data-action="accept"
    >
      Alle akzeptieren
    </button>
    
    <button 
      class="bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white font-medium px-4 py-2 rounded-md border border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300"
      data-action="necessary"
    >
      Nur Notwendige
    </button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('üç™ CookieConsent v1.2.1 initialized - SYNTAX FIXED');
  
  const banner = document.querySelector('.cookie-banner');
  
  if (!banner) {
    console.warn('Cookie banner not found');
    return;
  }
  
  // Check existing consent
  const existingConsent = localStorage.getItem('cookie-consent');
  if (existingConsent) {
    console.log('üç™ Consent already exists:', existingConsent);
    return;
  }
  
  // Show banner after delay
  setTimeout(() => {
    banner.classList.remove('translate-y-full', 'opacity-0');
    banner.classList.add('translate-y-0', 'opacity-100');
    console.log('üç™ Banner shown');
  }, 1000);
  
  // Simple event delegation for all buttons
  document.addEventListener('click', function(e) {
    const action = e.target.getAttribute('data-action');
    
    if (!action) return;
    
    if (action === 'accept') {
      console.log('üç™ Accepting all cookies');
      localStorage.setItem('cookie-consent', 'accept');
      document.cookie = 'cookie-consent=accept; path=/; max-age=15552000'; // 180 days
      hideBanner();
      
      // Load analytics
      window.dispatchEvent(new CustomEvent('cookieConsentAccepted'));
      
      // Load Google Analytics
      loadGoogleAnalytics();
    }
    else if (action === 'necessary' || action === 'decline') {
      console.log('üç™ Accepting only necessary cookies');
      localStorage.setItem('cookie-consent', 'decline');
      document.cookie = 'cookie-consent=decline; path=/; max-age=15552000'; // 180 days
      hideBanner();
    }
  });
  
  function hideBanner() {
    banner.classList.add('translate-y-full', 'opacity-0');
    banner.classList.remove('translate-y-0', 'opacity-100');
    
    setTimeout(() => {
      banner.style.display = 'none';
    }, 500);
  }
  
  function loadGoogleAnalytics() {
    if (window.gtag || document.querySelector('[src*="googletagmanager"]')) {
      console.log('üç™ Analytics already loaded');
      return;
    }
    
    console.log('üç™ Loading Google Analytics');
    
    const script = document.createElement('script');
    script.src = 'https://www.googletagmanager.com/gtag/js?id=G-08H9EG15DE';
    script.async = true;
    document.head.appendChild(script);
    
    script.onload = () => {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-08H9EG15DE', {
        anonymize_ip: true,
        respect_dnt: true
      });
      
      console.log('üç™ Google Analytics loaded');
    };
  }
});
</script>

<style is:global>
  .cookie-banner {
    font-family: 'Montserrat', system-ui, sans-serif;
  }

  .cookie-banner button {
    cursor: pointer;
  }

  .text-gold {
    color: #D2AE6C !important;
  }
  
  .bg-gold {
    background-color: #D2AE6C !important;
  }
  
  .hover\:bg-gold-dark:hover {
    background-color: #B8941A !important;
  }
  
  .bg-opacity-10 {
    background-color: rgba(210, 174, 108, 0.1) !important;
  }

  @media (max-width: 768px) {
    .cookie-banner .flex:last-child {
      flex-direction: column;
    }
    
    .cookie-banner .flex:last-child button {
      width: 100%;
    }
  }
</style>