---
// Header.astro v1.9.1 - Theme Toggle Fix + Logo korrigiert
// CHANGELOG v1.9.1:
// - ✅ FIX: Doppelte Theme Toggles entfernt (nur ThemeToggle.astro)
// - ✅ FIX: Logo SVG-Path korrigiert (Footer-Referenz)
// - ✅ KEEP: LinkedIn Button (Desktop + Mobile)
// - ✅ KEEP: Navigation + Dropdown-Funktionen + Mobile Menu

import ThemeToggle from './ThemeToggle.astro';

console.log('Header v1.9.1 - Theme Toggle Fix + Logo korrigiert');
---

<header class="bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 fixed w-full top-0 z-50 transition-all duration-300">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo mit zentriertem Text -->
      <div class="flex items-center">
        <a href="/" class="flex items-center space-x-3 hover:opacity-80 transition-opacity">
          <!-- ✅ VOLLSTÄNDIGER LOGO-PATH aus Logo.astro (funktionierend) -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 lg:w-12 lg:h-12 flex-shrink-0" viewBox="0 0 1778 1433">
            <path fill="#D2AE6C" d="M1346.536,147.84C1241.455,252.922,1136.736,357.643,1031.126,463.254C926.022,358.15,821.475,253.602,716.82,148.947C716.82,203.569,716.82,258.414,716.82,313.896C713.113,309.612,709.955,305.872,706.703,302.216C693.015,286.826,679.3,271.461,665.594,256.087C651.889,240.714,638.182,225.341,624.476,209.968C613.511,197.669,602.537,185.378,591.583,173.07C578.221,158.058,564.882,143.026,551.521,128.015C540.566,115.707,529.59,103.418,518.625,91.119C504.919,75.746,491.251,60.338,477.497,45.009C464.938,31.012,452.279,17.106,439.705,3.124C439.248,2.616,439.225,1.717,439.000,1.000C437.889,1.000,437.444,1.000,437,1.469C437,323.54,437,645.144,437,967C439.472,967,441.286,967,443.1,967C527.43,967,611.761,967.18,696.089,966.822C710.137,966.763,724.228,964.769,738.205,962.948C760.242,960.076,781.202,953.138,801.419,944.109C834.312,929.417,863.347,909.257,887.929,882.712C898.875,870.892,908.721,858.354,917.675,844.968C934.006,820.556,945.575,794.075,953.544,765.921C958.579,748.137,962.186,729.968,962.741,711.568C963.274,693.915,962.362,676.134,960.765,658.529C959.655,646.293,957.024,634.068,953.82,622.176C946.982,596.801,936.304,573.058,922.406,550.641C906.631,525.195,885.842,503.979,866.225,481.746C860.114,474.82,853.814,468.062,847.685,461.152C835.121,446.989,822.642,432.751,810.072,418.594C803.719,411.438,797.2,404.429,790.841,397.279C788.065,394.159,786.795,390.692,786.863,386.193C787.174,365.532,786.996,344.863,787.009,324.198C787.01,322.633,787.137,321.068,787.206,319.503C787.828,319.038,788.45,318.573,789.072,318.108C928.428,457.463,1067.783,596.819,1206.904,735.939C1206.807,736.29,1206.964,735.984,1206.965,735.679C1206.984,703.847,1207.045,672.014,1206.867,640.183C1206.856,638.253,1205.32,636.326,1204.647,634.375C1198.559,619.218,1186.967,608.126,1171.811,602.038C1162.618,598.37,1152.619,597.044,1142.747,596.994C1094.485,596.779,1046.222,596.891,997.961,596.891C997.961,615.295,997.961,633.358,997.961,651.905C1036.295,690.239,1074.628,728.572,1112.743,766.687C1095.406,766.641,1078.405,767.088,1061.42,766.526C1055.91,766.387,1050.267,765.205,1045.058,763.15C1026.422,755.504,1012.024,741.106,1004.378,722.47C999.999,712.756,998.221,702.267,997.961,691.622C997.961,672.539,997.961,653.455,997.961,634.372C997.961,632.807,997.961,631.242,997.961,629.676ZM1206.906,998.061C1068.572,859.728,930.238,721.394,791.904,583.06C791.904,564.656,791.904,546.593,791.904,528.047C753.57,489.713,715.237,451.38,677.121,413.265C694.458,413.311,711.459,412.864,728.444,413.426C733.954,413.565,739.597,414.747,744.806,416.802C763.442,424.448,777.84,438.846,785.486,457.482C789.865,467.196,791.643,477.685,791.904,488.33C791.904,507.413,791.904,526.497,791.904,545.58C791.904,547.145,791.904,548.71,791.904,550.276C830.238,588.61,868.571,626.943,906.687,665.058C906.741,630.665,906.294,596.605,906.856,562.561C906.995,557.051,908.177,551.408,910.232,546.199C917.878,527.563,932.276,513.165,950.912,505.519C960.626,501.14,971.115,499.362,981.76,499.101C1000.843,499.101,1019.927,499.101,1039.01,499.101C1040.575,499.101,1042.14,499.101,1043.706,499.101C1043.706,519.101,1043.706,538.434,1043.706,558.101C1043.659,595.768,1044.106,633.1,1043.544,670.417C1043.405,675.927,1042.223,681.57,1040.168,686.779C1032.522,705.415,1018.124,719.813,999.488,727.459C989.774,731.838,979.285,733.616,968.64,733.877C949.557,733.877,930.473,733.877,911.39,733.877C909.825,733.877,908.26,733.877,906.694,733.877"/>
          </svg>
          <div class="flex flex-col justify-center">
            <div class="text-xl font-bold text-gray-900 dark:text-white leading-tight">Dominik Maier</div>
            <div class="text-sm text-gray-600 dark:text-gray-300 leading-tight">Coaching & Interim Management</div>
          </div>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center space-x-8">
        <a href="/" class="text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Start</a>
        
        <!-- Services Dropdown -->
        <div class="relative group">
          <button 
            id="leistungen-dropdown"
            class="flex items-center text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors"
            aria-haspopup="true"
            aria-expanded="false"
          >
            Leistungen
            <svg class="ml-1 w-4 h-4 transition-transform group-hover:rotate-180" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
          
          <div 
            id="leistungen-menu"
            class="absolute top-full left-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"
          >
            <div class="py-2">
              <a href="/leistung/strategische-unternehmensentwicklung" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">
                <div class="font-medium">Strategische Unternehmensentwicklung</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Nachhaltige Strategien für Wachstum</div>
              </a>
              <a href="/leistung/vertriebsoptimierung" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">
                <div class="font-medium">Vertriebsoptimierung</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Prozesse optimieren, Märkte erschließen</div>
              </a>
              <a href="/leistung/marketing-konzepte" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">
                <div class="font-medium">Marketing-Konzepte</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Zielgerichtete Marketingstrategien</div>
              </a>
              <a href="/leistung/value-management" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">
                <div class="font-medium">Value Management</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Prozesse und Produkte optimieren</div>
              </a>
            </div>
          </div>
        </div>

        <a href="/blog" class="text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Blog</a>
        <a href="/ueber-mich" class="text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Über mich</a>
        <a href="/kontakt" class="text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Kontakt</a>
      </nav>

      <!-- ✅ PWA-INTEGRATION: Desktop Action Buttons -->
      <div class="hidden lg:flex items-center space-x-4">
        <!-- Theme Toggle -->
        <ThemeToggle size="md" position="header" variant="minimal" />
        
        <!-- LinkedIn Button -->
        <a 
          href="https://www.linkedin.com/in/dominik-maier-22144710a/" 
          target="_blank" 
          rel="noopener noreferrer"
          class="p-2 text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors rounded-md"
          aria-label="Dominik Maier LinkedIn-Profil öffnen"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"></path>
          </svg>
        </a>
      </div>

      <!-- ✅ PWA-INTEGRATION: Mobile Buttons + Menu -->
      <div class="lg:hidden flex items-center space-x-3">
        <!-- Theme Toggle Mobile -->
        <ThemeToggle size="sm" position="header" variant="minimal" />
        
        <!-- LinkedIn Button Mobile -->
        <a 
          href="https://www.linkedin.com/in/dominik-maier-22144710a/" 
          target="_blank" 
          rel="noopener noreferrer"
          class="p-2 text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors rounded-md"
          aria-label="LinkedIn öffnen"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"></path>
          </svg>
        </a>
        
        <!-- Mobile Menu Button -->
        <button 
          id="mobile-menu-toggle"
          class="p-2 text-gray-700 dark:text-gray-300 hover:text-primary-gold dark:hover:text-primary-gold transition-colors rounded-md"
          aria-label="Menu öffnen"
          aria-expanded="false"
        >
          <svg id="menu-open-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg id="menu-close-icon" class="hidden w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="lg:hidden hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
      <div class="py-4 space-y-2">
        <a href="/" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Start</a>
        
        <!-- Mobile Services -->
        <div>
          <button 
            id="mobile-leistungen-toggle"
            class="flex items-center justify-between w-full px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors"
            aria-expanded="false"
          >
            Leistungen
            <svg id="mobile-leistungen-arrow" class="w-4 h-4 transition-transform" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="mobile-leistungen-menu" class="hidden bg-gray-50 dark:bg-gray-700">
            <a href="/leistung/strategische-unternehmensentwicklung" class="block px-8 py-2 text-gray-600 dark:text-gray-400 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Strategische Unternehmensentwicklung</a>
            <a href="/leistung/vertriebsoptimierung" class="block px-8 py-2 text-gray-600 dark:text-gray-400 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Vertriebsoptimierung</a>
            <a href="/leistung/marketing-konzepte" class="block px-8 py-2 text-gray-600 dark:text-gray-400 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Marketing-Konzepte</a>
            <a href="/leistung/value-management" class="block px-8 py-2 text-gray-600 dark:text-gray-400 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Value Management</a>
          </div>
        </div>

        <a href="/blog" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Blog</a>
        <a href="/ueber-mich" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Über mich</a>
        <a href="/kontakt" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold transition-colors">Kontakt</a>
      </div>
    </div>
  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Header v1.9.1 JavaScript wird initialisiert...');
  
  // Universal Event Listener für bessere Touch-Kompatibilität
  function addUniversalEventListener(element, callback) {
    if (element) {
      element.addEventListener('click', callback);
      element.addEventListener('touchend', function(e) {
        e.preventDefault();
        callback(e);
      });
    }
  }

  // Mobile Menu Toggle
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuOpenIcon = document.getElementById('menu-open-icon');
  const menuCloseIcon = document.getElementById('menu-close-icon');

  if (mobileMenuToggle && mobileMenu) {
    function toggleMobileMenu() {
      const isHidden = mobileMenu.classList.contains('hidden');
      console.log('Mobile Menu Toggle:', isHidden ? 'OPENING' : 'CLOSING');
      
      if (isHidden) {
        mobileMenu.classList.remove('hidden');
        menuOpenIcon.classList.add('hidden');
        menuCloseIcon.classList.remove('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'true');
      } else {
        mobileMenu.classList.add('hidden');
        menuOpenIcon.classList.remove('hidden');
        menuCloseIcon.classList.add('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'false');
      }
    }
    
    addUniversalEventListener(mobileMenuToggle, toggleMobileMenu);
  }

  // Desktop Services Dropdown
  const leistungenDropdown = document.getElementById('leistungen-dropdown');
  const leistungenMenu = document.getElementById('leistungen-menu');

  if (leistungenDropdown && leistungenMenu) {
    function showDropdown() {
      leistungenMenu.classList.remove('opacity-0', 'invisible');
      leistungenMenu.classList.add('opacity-100', 'visible');
      leistungenDropdown.setAttribute('aria-expanded', 'true');
    }

    function hideDropdown() {
      leistungenMenu.classList.remove('opacity-100', 'visible');
      leistungenMenu.classList.add('opacity-0', 'invisible');
      leistungenDropdown.setAttribute('aria-expanded', 'false');
    }

    leistungenDropdown.addEventListener('mouseenter', showDropdown);
    leistungenDropdown.addEventListener('mouseleave', hideDropdown);
    leistungenMenu.addEventListener('mouseenter', showDropdown);
    leistungenMenu.addEventListener('mouseleave', hideDropdown);
  }

  // Mobile Services Accordion
  const mobileLeistungenToggle = document.getElementById('mobile-leistungen-toggle');
  const mobileLeistungenMenu = document.getElementById('mobile-leistungen-menu');
  const mobileLeistungenArrow = document.getElementById('mobile-leistungen-arrow');

  if (mobileLeistungenToggle && mobileLeistungenMenu) {
    function toggleMobileServices() {
      const isHidden = mobileLeistungenMenu.classList.contains('hidden');
      console.log('Mobile Services Toggle:', isHidden ? 'OPENING' : 'CLOSING');
      
      if (isHidden) {
        mobileLeistungenMenu.classList.remove('hidden');
        mobileLeistungenArrow.classList.add('rotate-180');
        mobileLeistungenToggle.setAttribute('aria-expanded', 'true');
      } else {
        mobileLeistungenMenu.classList.add('hidden');
        mobileLeistungenArrow.classList.remove('rotate-180');
        mobileLeistungenToggle.setAttribute('aria-expanded', 'false');
      }
    }
    
    addUniversalEventListener(mobileLeistungenToggle, toggleMobileServices);
  }

  console.log('Header v1.9.0 - Logo-Fix + PWA-Integration komplett initialisiert');
});
</script>

<style>
  /* Universal Touch Optimierungen */
  button {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    touch-action: manipulation;
  }
  
  /* Logo-Text Zentrierung */
  .flex-shrink-0 {
    flex-shrink: 0;
  }
  
  .leading-tight {
    line-height: 1.25;
  }
  
  /* Rotation Animation */
  .rotate-180 {
    transform: rotate(180deg);
  }
  
  .transition-transform {
    transition: transform 0.3s ease;
  }
  
  /* Dropdown States */
  .opacity-0 {
    opacity: 0;
  }
  
  .opacity-100 {
    opacity: 1;
  }
  
  .invisible {
    visibility: hidden;
  }
  
  .visible {
    visibility: visible;
  }
  
  /* Mobile Touch Area Vergrößerung */
  @media (max-width: 1024px) {
    button {
      min-height: 44px;
      min-width: 44px;
    }
  }
  
  /* PWA Button Styling */
  .rounded-md {
    border-radius: 0.375rem;
  }
  
  /* Hover-Effekte für Links */
  a[href*="linkedin"]:hover svg {
    transform: scale(1.1);
    transition: transform 0.2s ease;
  }
</style>
