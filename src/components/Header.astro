---
import ThemeToggle from './ThemeToggle.astro';
import Logo from './Logo.astro';
---

<header class="sticky top-0 z-50 w-full bg-light-darker/90 dark:bg-dark-lighter/90 backdrop-blur-sm border-b border-light-darkest dark:border-dark-lightest shadow-sm">
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <a href="/" class="flex items-center" aria-label="Home">
      <Logo height={40} />
    </a>
    
    <!-- Mobile Menu Button -->
    <button 
      id="menu-toggle" 
      class="lg:hidden flex items-center p-2 text-text-dark dark:text-text-light"
      aria-label="Toggle Menu"
    >
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
      </svg>
    </button>
    
    <!-- Desktop Navigation -->
    <nav class="hidden lg:flex items-center space-x-8">
      <a href="/" class="nav-link">Home</a>
      
      <!-- Dropdown for services -->
      <div class="relative dropdown-menu">
        <button 
          class="nav-link flex items-center" 
          id="services-dropdown-button" 
          aria-expanded="false" 
          aria-haspopup="true"
        >
          Leistungen
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 ml-1 transition-transform" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div 
          id="services-dropdown" 
          class="absolute left-0 mt-2 w-64 rounded-md shadow-lg bg-white dark:bg-dark-lighter border border-light-darkest dark:border-dark-lightest hidden dropdown-content z-50"
        >
          <div class="rounded-md py-1">
            <a href="/leistung/strategische-unternehmensentwicklung" class="block px-4 py-2 text-sm text-text-dark dark:text-text-light hover:bg-light-darker dark:hover:bg-dark-lightest dropdown-item">
              Strategische Unternehmensentwicklung
            </a>
            <a href="/leistung/vertriebsoptimierung" class="block px-4 py-2 text-sm text-text-dark dark:text-text-light hover:bg-light-darker dark:hover:bg-dark-lightest dropdown-item">
              Vertriebsoptimierung
            </a>
            <a href="/leistung/marketing-strategien" class="block px-4 py-2 text-sm text-text-dark dark:text-text-light hover:bg-light-darker dark:hover:bg-dark-lightest dropdown-item">
              Marketing-Strategien
            </a>
            <a href="/leistung/wertanalyse" class="block px-4 py-2 text-sm text-text-dark dark:text-text-light hover:bg-light-darker dark:hover:bg-dark-lightest dropdown-item">
              Optimierung von Prozessen & Produkten
            </a>
          </div>
        </div>
      </div>
      
      <a href="/ueber-mich" class="nav-link">Über Mich</a>
      <a href="/kontakt" class="nav-link">Kontakt</a>
      
      <div class="flex items-center space-x-4">
        <ThemeToggle />
        <a 
          href="https://www.linkedin.com/in/dominik-maier-22144710a/" 
          target="_blank" 
          rel="noopener noreferrer"
          aria-label="LinkedIn Profil"
          class="text-text-dark dark:text-text-light hover:text-primary-gold dark:hover:text-primary-gold"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"></path>
          </svg>
        </a>
      </div>
    </nav>
  </div>
</header>

<!-- Mobile Navigation (Fullscreen overlay) -->
<div id="mobile-menu" class="fixed inset-0 bg-white dark:bg-dark z-[999] flex-col lg:hidden hidden">
  <div class="flex justify-between items-center p-4 border-b border-light-darkest dark:border-dark-lightest">
    <a href="/" class="flex items-center" aria-label="Home">
      <Logo height={40} />
    </a>
    <button id="close-menu" class="p-2 text-text-dark dark:text-text-light" aria-label="Close Menu">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
  
  <div class="flex-1 overflow-y-auto py-4 px-4">
    <nav class="flex flex-col space-y-5">
      <a href="/" class="py-2 text-lg text-text-dark dark:text-text-light">Home</a>
      
      <!-- Mobile dropdown for services -->
      <div class="services-mobile-dropdown">
        <button 
          id="mobile-services-button"
          class="flex justify-between items-center w-full py-2 text-lg text-text-dark dark:text-text-light" 
          aria-expanded="false"
        >
          <span>Leistungen</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="mobile-dropdown-icon w-5 h-5 transition-transform duration-300" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div id="mobile-services-content" class="pl-4 mt-2 space-y-3 border-l-2 border-primary-gold hidden">
          <a href="/leistung/strategische-unternehmensentwicklung" class="block py-2 text-base text-text-dark dark:text-text-light hover:text-primary-gold">
            Strategische Unternehmensentwicklung
          </a>
          <a href="/leistung/vertriebsoptimierung" class="block py-2 text-base text-text-dark dark:text-text-light hover:text-primary-gold">
            Vertriebsoptimierung
          </a>
          <a href="/leistung/marketing-strategien" class="block py-2 text-base text-text-dark dark:text-text-light hover:text-primary-gold">
            Marketing-Strategien
          </a>
          <a href="/leistung/wertanalyse" class="block py-2 text-base text-text-dark dark:text-text-light hover:text-primary-gold">
            Optimierung von Prozessen & Produkten
          </a>
        </div>
      </div>
      
      <a href="/ueber-mich" class="py-2 text-lg text-text-dark dark:text-text-light">Über Mich</a>
      <a href="/kontakt" class="py-2 text-lg text-text-dark dark:text-text-light">Kontakt</a>
      
      <div class="flex items-center space-x-4 pt-4 border-t border-light-darkest dark:border-dark-lightest mt-2">
        <ThemeToggle />
        <a 
          href="https://www.linkedin.com/in/dominik-maier-22144710a/" 
          target="_blank"
          rel="noopener noreferrer"
          aria-label="LinkedIn Profil"
          class="text-text-dark dark:text-text-light hover:text-primary-gold"
        >
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"></path>
          </svg>
        </a>
      </div>
    </nav>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Mobile menu toggle
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeMenu = document.getElementById('close-menu');
    
    if (menuToggle && mobileMenu && closeMenu) {
      menuToggle.addEventListener('click', () => {
        mobileMenu.classList.remove('hidden');
        mobileMenu.classList.add('flex');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
      });
      
      closeMenu.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        mobileMenu.classList.remove('flex');
        document.body.style.overflow = ''; // Enable scrolling
      });
    }
    
    // Mobile services dropdown
    const mobileServicesButton = document.getElementById('mobile-services-button');
    const mobileServicesContent = document.getElementById('mobile-services-content');
    
    if (mobileServicesButton && mobileServicesContent) {
      mobileServicesButton.addEventListener('click', () => {
        // Toggle dropdown visibility
        const expanded = mobileServicesButton.getAttribute('aria-expanded') === 'true' || false;
        mobileServicesButton.setAttribute('aria-expanded', (!expanded).toString());
        
        mobileServicesContent.classList.toggle('hidden');
        
        // Toggle icon rotation
        const icon = mobileServicesButton.querySelector('.mobile-dropdown-icon');
        if (icon) {
          icon.classList.toggle('rotate-180');
        }
        
        // Log for debugging
        console.log('Mobile services dropdown clicked', {
          expanded: !expanded,
          isHidden: mobileServicesContent.classList.contains('hidden')
        });
      });
      
      // Make links clickable
      const serviceLinks = mobileServicesContent.querySelectorAll('a');
      serviceLinks.forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
          mobileMenu.classList.remove('flex');
          document.body.style.overflow = ''; // Enable scrolling
        });
      });
    }
    
    // Other mobile links
    const mobileLinks = mobileMenu?.querySelectorAll('nav > a');
    if (mobileLinks && mobileMenu) {
      mobileLinks.forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
          mobileMenu.classList.remove('flex');
          document.body.style.overflow = ''; // Enable scrolling
        });
      });
    }
    
    // Desktop dropdown for services
    const servicesDropdownButton = document.getElementById('services-dropdown-button');
    const servicesDropdown = document.getElementById('services-dropdown');
    
    if (servicesDropdownButton && servicesDropdown) {
      let isDropdownOpen = false;
      
      // Function to open the dropdown
      const openDropdown = () => {
        servicesDropdown.classList.remove('hidden');
        servicesDropdownButton.setAttribute('aria-expanded', 'true');
        servicesDropdownButton.querySelector('svg').classList.add('rotate-180');
        isDropdownOpen = true;
      };
      
      // Function to close the dropdown
      const closeDropdown = () => {
        servicesDropdown.classList.add('hidden');
        servicesDropdownButton.setAttribute('aria-expanded', 'false');
        servicesDropdownButton.querySelector('svg').classList.remove('rotate-180');
        isDropdownOpen = false;
      };
      
      // Toggle dropdown on button click
      servicesDropdownButton.addEventListener('click', (event) => {
        event.stopPropagation();
        if (isDropdownOpen) {
          closeDropdown();
        } else {
          openDropdown();
        }
      });
      
      // Add click event to all dropdown items to close when selected
      const dropdownItems = servicesDropdown.querySelectorAll('a');
      dropdownItems.forEach(item => {
        item.addEventListener('click', () => {
          closeDropdown();
        });
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (event) => {
        if (isDropdownOpen && 
            !servicesDropdownButton.contains(event.target) && 
            !servicesDropdown.contains(event.target)) {
          closeDropdown();
        }
      });
      
      // Close dropdown when pressing escape key
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && isDropdownOpen) {
          closeDropdown();
        }
      });
      
      // Hover behavior (optional)
      if (window.matchMedia("(min-width: 1024px)").matches) {
        const handleHover = (enter) => {
          if (enter && !isDropdownOpen) {
            openDropdown();
          }
        };
        
        servicesDropdownButton.addEventListener('mouseenter', () => handleHover(true));
        
        const handleMouseLeave = () => {
          setTimeout(() => {
            const isDropdownHovered = servicesDropdown.matches(':hover');
            const isButtonHovered = servicesDropdownButton.matches(':hover');
            
            if (!isDropdownHovered && !isButtonHovered && !servicesDropdown.contains(document.activeElement)) {
              closeDropdown();
            }
          }, 100);
        };
        
        servicesDropdownButton.addEventListener('mouseleave', handleMouseLeave);
        servicesDropdown.addEventListener('mouseleave', handleMouseLeave);
      }
    }
  });
</script>

<style>
  .nav-link {
    position: relative;
    font-weight: 500;
    padding: 0.5rem 0;
  }
  
  .nav-link::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: 0;
    left: 0;
    background-color: #D4AF37;
    transition: width 0.3s;
  }
  
  .nav-link:hover::after {
    width: 100%;
  }
  
  /* Animation for dropdown */
  .dropdown-content {
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }
  
  .dropdown-content:not(.hidden) {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Mobile dropdown animation */
  .mobile-dropdown-icon {
    transition: transform 0.3s ease;
  }
  
  .rotate-180 {
    transform: rotate(180deg);
  }
  
  #mobile-menu {
    transition: opacity 0.3s ease;
  }
  
  #mobile-menu.flex {
    animation: fadeIn 0.3s forwards;
  }
  
  /* Services mobile dropdown */
  #mobile-services-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
  }
  
  #mobile-services-content:not(.hidden) {
    max-height: 500px;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>