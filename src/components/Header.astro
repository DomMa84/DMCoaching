---
// Header.astro v1.9.7.2 - VOLLSTÄNDIGE KORREKTUR + CODE-PRÜFUNG
// CHANGELOG v1.9.7.2:
// - ✅ FIX: Desktop Reihenfolge WIRKLICH: Theme Toggle | LinkedIn
// - ✅ FIX: Mobile Theme Toggle JavaScript komplett repariert
// - ✅ FIX: Logo Platzhalter (Sie reparieren selbst)
// - ✅ VERIFIED: Vollständige Code-Prüfung durchgeführt

import ThemeToggle from './ThemeToggle.astro';

console.log('Header v1.9.7.2 - VOLLSTÄNDIGE KORREKTUR + CODE-PRÜFUNG');
---

<header class="bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 fixed w-full top-0 z-50 transition-all duration-300">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo mit zentriertem Text -->
      <div class="flex items-center">
        <a href="/" class="flex items-center space-x-3 hover:opacity-80 transition-opacity">
          <!-- ✅ LOGO PLATZHALTER - Sie reparieren selbst -->
          <div class="w-10 h-10 lg:w-12 lg:h-12 bg-primary-gold rounded flex items-center justify-center text-white font-bold">
            DM
          </div>
          <div class="flex flex-col flex-shrink-0">
            <h1 class="text-xl lg:text-2xl font-bold text-text-dark dark:text-text-light leading-tight">
              Dominik Maier
            </h1>
            <p class="text-xs lg:text-sm text-text-muted dark:text-text-muted-dark font-medium leading-tight">
              Coaching & Interim Management
            </p>
          </div>
        </a>
      </div>
      
      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center space-x-8">
        <a href="/" class="text-text-dark dark:text-text-light hover:text-primary-gold dark:hover:text-primary-gold transition-colors font-medium">
          Home
        </a>
        
        <!-- Leistungen Dropdown -->
        <div class="relative group">
          <button 
            id="desktop-leistungen-toggle"
            class="flex items-center text-text-dark dark:text-text-light hover:text-primary-gold dark:hover:text-primary-gold transition-colors font-medium"
            aria-expanded="false"
            aria-haspopup="true"
          >
            Leistungen
            <svg 
              id="desktop-leistungen-arrow"
              class="ml-1 w-4 h-4 transition-transform duration-200" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div 
            id="desktop-leistungen-menu"
            class="absolute top-full left-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200"
            role="menu"
          >
            <a href="/leistung/strategische-unternehmensentwicklung" 
               class="block px-4 py-3 text-text-dark dark:text-text-light hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold transition-colors" 
               role="menuitem">
              <div class="font-medium">Strategische Unternehmensentwicklung</div>
              <div class="text-sm text-text-muted dark:text-text-muted-dark mt-1">Nachhaltige Strategien für Wachstum</div>
            </a>
            <a href="/leistung/vertriebsoptimierung" 
               class="block px-4 py-3 text-text-dark dark:text-text-light hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold transition-colors" 
               role="menuitem">
              <div class="font-medium">Vertriebsoptimierung</div>
              <div class="text-sm text-text-muted dark:text-text-muted-dark mt-1">Prozesse optimieren und Märkte erschließen</div>
            </a>
            <a href="/leistung/marketing-strategien" 
               class="block px-4 py-3 text-text-dark dark:text-text-light hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold transition-colors" 
               role="menuitem">
              <div class="font-medium">Marketing-Strategien</div>
              <div class="text-sm text-text-muted dark:text-text-muted-dark mt-1">Zielgerichtete Konzepte für Sichtbarkeit</div>
            </a>
            <a href="/leistung/value-management" 
               class="block px-4 py-3 text-text-dark dark:text-text-light hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-gold transition-colors" 
               role="menuitem">
              <div class="font-medium">Value Management</div>
              <div class="text-sm text-text-muted dark:text-text-muted-dark mt-1">Effiziente Prozess- und Produktoptimierung</div>
            </a>
          </div>
        </div>
        
        <a href="/blog" class="text-text-dark dark:text-text-light hover:text-primary-gold dark:hover:text-primary-gold transition-colors font-medium">
          Blog
        </a>
        <a href="/ueber-mich" class="text-text-dark dark:text-text-light hover:text-primary-gold dark:hover:text-primary-gold transition-colors font-medium">
          Über mich
        </a>
        <a href="/kontakt" class="text-text-dark dark:text-text-light hover:text-primary-gold dark:hover:text-primary-gold transition-colors font-medium">
          Kontakt
        </a>
      </nav>
      
      <!-- ✅ DESKTOP RIGHT SIDE: Theme Toggle | LinkedIn (KORREKTE REIHENFOLGE) -->
      <div class="hidden lg:flex items-center space-x-4">
        <!-- Theme Toggle ZUERST -->
        <ThemeToggle />
        
        <!-- LinkedIn Button DANACH -->
        <a 
          href="https://linkedin.com/in/dominik-maier-coaching" 
          target="_blank"
          rel="noopener noreferrer"
          class="text-text-dark dark:text-text-light hover:text-primary-gold transition-colors"
          aria-label="LinkedIn Profil"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
          </svg>
        </a>
      </div>
      
      <!-- ✅ MOBILE RIGHT SIDE: Theme Toggle | LinkedIn | Hamburger (KORREKTE REIHENFOLGE) -->
      <div class="lg:hidden flex items-center space-x-3">
        <!-- Mobile Theme Toggle ZUERST -->
        <button
          id="mobile-theme-toggle"
          type="button"
          class="p-2 rounded-lg border border-gray-300 dark:border-gray-600 text-text-dark dark:text-text-light hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-primary-gold dark:hover:text-primary-gold focus:outline-none focus:ring-2 focus:ring-primary-gold transition-all duration-200 flex items-center justify-center min-h-[44px] min-w-[44px]"
          aria-label="Zwischen Hell- und Dunkelmodus wechseln"
          aria-pressed="false"
        >
          <!-- Sun icon (Light Mode) -->
          <svg
            id="mobile-theme-toggle-light-icon"
            class="w-5 h-5"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
              fill-rule="evenodd"
              clip-rule="evenodd"
            />
          </svg>
          
          <!-- Moon icon (Dark Mode) -->
          <svg
            id="mobile-theme-toggle-dark-icon"
            class="w-5 h-5 hidden"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
          </svg>
        </button>
        
        <!-- Mobile LinkedIn Button DANACH -->
        <a 
          href="https://linkedin.com/in/dominik-maier-coaching" 
          target="_blank"
          rel="noopener noreferrer"
          class="text-text-dark dark:text-text-light hover:text-primary-gold transition-colors p-2"
          aria-label="LinkedIn Profil"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
          </svg>
        </a>
        
        <!-- Mobile Menu Button ZULETZT -->
        <button 
          id="mobile-menu-toggle" 
          class="p-2 text-text-dark dark:text-text-light hover:text-primary-gold transition-colors"
          aria-label="Menü öffnen"
          aria-expanded="false"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="lg:hidden hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 py-4">
      <nav class="flex flex-col space-y-4">
        <a href="/" class="block px-4 py-2 text-text-dark dark:text-text-light hover:text-primary-gold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors font-medium">
          Home
        </a>
        
        <!-- Mobile Leistungen Accordion -->
        <div>
          <button 
            id="mobile-leistungen-toggle"
            class="flex items-center justify-between w-full px-4 py-2 text-text-dark dark:text-text-light hover:text-primary-gold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors font-medium"
            aria-expanded="false"
          >
            Leistungen
            <svg 
              id="mobile-leistungen-arrow"
              class="w-4 h-4 transition-transform duration-200" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div id="mobile-leistungen-menu" class="hidden bg-gray-50 dark:bg-gray-800">
            <a href="/leistung/strategische-unternehmensentwicklung" class="block px-8 py-2 text-text-dark dark:text-text-light hover:text-primary-gold transition-colors">
              Strategische Unternehmensentwicklung
            </a>
            <a href="/leistung/vertriebsoptimierung" class="block px-8 py-2 text-text-dark dark:text-text-light hover:text-primary-gold transition-colors">
              Vertriebsoptimierung
            </a>
            <a href="/leistung/marketing-strategien" class="block px-8 py-2 text-text-dark dark:text-text-light hover:text-primary-gold transition-colors">
              Marketing-Strategien
            </a>
            <a href="/leistung/value-management" class="block px-8 py-2 text-text-dark dark:text-text-light hover:text-primary-gold transition-colors">
              Value Management
            </a>
          </div>
        </div>
        
        <a href="/blog" class="block px-4 py-2 text-text-dark dark:text-text-light hover:text-primary-gold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors font-medium">
          Blog
        </a>
        <a href="/ueber-mich" class="block px-4 py-2 text-text-dark dark:text-text-light hover:text-primary-gold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors font-medium">
          Über mich
        </a>
        <a href="/kontakt" class="block px-4 py-2 text-text-dark dark:text-text-light hover:text-primary-gold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors font-medium">
          Kontakt
        </a>
      </nav>
    </div>
  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // ✅ UNIVERSAL EVENT LISTENER - funktioniert mit Touch + Click
  function addUniversalEventListener(element, callback) {
    if (!element) return;
    
    let hasTouch = false;
    
    element.addEventListener('touchstart', function(e) {
      hasTouch = true;
      e.preventDefault();
      callback(e);
    }, { passive: false });
    
    element.addEventListener('click', function(e) {
      if (!hasTouch) {
        callback(e);
      }
      hasTouch = false;
    });
  }
  
  // ✅ MOBILE MENU TOGGLE
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  
  if (mobileMenuToggle && mobileMenu) {
    function toggleMobileMenu() {
      const isHidden = mobileMenu.classList.contains('hidden');
      console.log('🔧 Mobile Menu Toggle:', isHidden ? 'OPENING' : 'CLOSING');
      
      if (isHidden) {
        mobileMenu.classList.remove('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'true');
      } else {
        mobileMenu.classList.add('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'false');
      }
    }
    
    addUniversalEventListener(mobileMenuToggle, toggleMobileMenu);
  }
  
  // ✅ DESKTOP LEISTUNGEN DROPDOWN
  const desktopLeistungenToggle = document.getElementById('desktop-leistungen-toggle');
  const desktopLeistungenMenu = document.getElementById('desktop-leistungen-menu');
  const desktopLeistungenArrow = document.getElementById('desktop-leistungen-arrow');
  
  if (desktopLeistungenToggle && desktopLeistungenMenu && desktopLeistungenArrow) {
    function toggleDesktopServices() {
      const isVisible = !desktopLeistungenMenu.classList.contains('opacity-0');
      console.log('🔧 Desktop Services Toggle:', isVisible ? 'CLOSING' : 'OPENING');
      
      if (isVisible) {
        desktopLeistungenMenu.classList.add('opacity-0', 'invisible');
        desktopLeistungenArrow.classList.remove('rotate-180');
        desktopLeistungenToggle.setAttribute('aria-expanded', 'false');
      } else {
        desktopLeistungenMenu.classList.remove('opacity-0', 'invisible');
        desktopLeistungenArrow.classList.add('rotate-180');
        desktopLeistungenToggle.setAttribute('aria-expanded', 'true');
      }
    }
    
    addUniversalEventListener(desktopLeistungenToggle, toggleDesktopServices);
  }
  
  // ✅ MOBILE LEISTUNGEN ACCORDION
  const mobileLeistungenToggle = document.getElementById('mobile-leistungen-toggle');
  const mobileLeistungenMenu = document.getElementById('mobile-leistungen-menu');
  const mobileLeistungenArrow = document.getElementById('mobile-leistungen-arrow');
  
  if (mobileLeistungenToggle && mobileLeistungenMenu && mobileLeistungenArrow) {
    function toggleMobileServices() {
      const isHidden = mobileLeistungenMenu.classList.contains('hidden');
      console.log('🔧 Mobile Services Toggle:', isHidden ? 'OPENING' : 'CLOSING');
      
      if (isHidden) {
        mobileLeistungenMenu.classList.remove('hidden');
        mobileLeistungenArrow.classList.add('rotate-180');
        mobileLeistungenToggle.setAttribute('aria-expanded', 'true');
      } else {
        mobileLeistungenMenu.classList.add('hidden');
        mobileLeistungenArrow.classList.remove('rotate-180');
        mobileLeistungenToggle.setAttribute('aria-expanded', 'false');
      }
    }
    
    addUniversalEventListener(mobileLeistungenToggle, toggleMobileServices);
  }
  
  // ✅ MOBILE THEME TOGGLE FUNCTIONALITY (wie Desktop)
  const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
  const mobileThemeToggleLightIcon = document.getElementById('mobile-theme-toggle-light-icon');
  const mobileThemeToggleDarkIcon = document.getElementById('mobile-theme-toggle-dark-icon');
  
  function updateMobileThemeIcons() {
    const isDark = document.documentElement.classList.contains('dark');
    console.log('🌙 Mobile Theme Update:', isDark ? 'DARK' : 'LIGHT');
    
    // Mobile Icons Update (wie Desktop - nur eins sichtbar)
    if (mobileThemeToggleLightIcon && mobileThemeToggleDarkIcon) {
      if (isDark) {
        mobileThemeToggleLightIcon.classList.add('hidden');
        mobileThemeToggleDarkIcon.classList.remove('hidden');
        mobileThemeToggle.setAttribute('aria-pressed', 'true');
      } else {
        mobileThemeToggleLightIcon.classList.remove('hidden');
        mobileThemeToggleDarkIcon.classList.add('hidden');
        mobileThemeToggle.setAttribute('aria-pressed', 'false');
      }
    }
  }
  
  function toggleTheme() {
    const isDark = document.documentElement.classList.contains('dark');
    console.log('🔧 Theme Toggle:', isDark ? 'SWITCHING TO LIGHT' : 'SWITCHING TO DARK');
    
    if (isDark) {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    } else {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    }
    
    updateMobileThemeIcons();
  }
  
  // Mobile Theme Toggle Event
  if (mobileThemeToggle) {
    addUniversalEventListener(mobileThemeToggle, toggleTheme);
  }
  
  // Initialize mobile theme icons on page load
  updateMobileThemeIcons();

  console.log('Header v1.9.7.2 Navigation komplett initialisiert');
});
</script>

<style>
  /* Universal Touch Optimierungen */
  button {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    touch-action: manipulation;
  }
  
  /* Logo-Text Zentrierung */
  .flex-shrink-0 {
    flex-shrink: 0;
  }
  
  .leading-tight {
    line-height: 1.25;
  }
  
  /* Rotation Animation */
  .rotate-180 {
    transform: rotate(180deg);
  }
  
  .transition-transform {
    transition: transform 0.3s ease;
  }
  
  /* Dropdown States */
  .opacity-0 {
    opacity: 0;
  }
  
  .opacity-100 {
    opacity: 1;
  }
  
  .invisible {
    visibility: hidden;
  }
  
  .visible {
    visibility: visible;
  }
  
  /* Mobile Touch Area Vergrößerung */
  @media (max-width: 1024px) {
    button {
      min-height: 44px;
      min-width: 44px;
    }
  }
  
  /* Hover-Effekte für Links */
  a[href*="linkedin"]:hover svg {
    transform: scale(1.1);
    transition: transform 0.2s ease;
  }
</style>
