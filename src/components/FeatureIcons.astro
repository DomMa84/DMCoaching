---
// src/components/FeatureIcons.astro v1.0 (Server-Mode & Animation optimiert)
// FeatureIcons - Animated icon display component

interface Props {
  count: number;
  maxCount?: number;
  size?: "sm" | "md" | "lg" | "xl";
  variant?: "default" | "filled" | "outline" | "minimal";
  theme?: "gold" | "blue" | "green" | "purple" | "gradient";
  animationType?: "bounce" | "fade" | "scale" | "slide";
  staggerDelay?: number;
  className?: string;
  iconSet?: "business" | "tech" | "achievement" | "custom";
  customIcons?: string[];
}

const { 
  count, 
  maxCount = 5, 
  size = "md",
  variant = "default",
  theme = "gold",
  animationType = "bounce",
  staggerDelay = 100,
  className = "",
  iconSet = "business",
  customIcons = []
} = Astro.props;

// Normalize count to valid range
const normalizedCount = Math.min(Math.max(Math.floor(count), 0), maxCount);

// Size classes with enhanced options
const sizeMap = {
  sm: "w-4 h-4",
  md: "w-6 h-6", 
  lg: "w-8 h-8",
  xl: "w-10 h-10"
};

// Theme colors
const themes = {
  gold: {
    active: "text-primary-gold",
    inactive: "text-primary-gold/30"
  },
  blue: {
    active: "text-blue-500",
    inactive: "text-blue-500/30"
  },
  green: {
    active: "text-green-500", 
    inactive: "text-green-500/30"
  },
  purple: {
    active: "text-purple-500",
    inactive: "text-purple-500/30"
  },
  gradient: {
    active: "text-transparent bg-clip-text bg-gradient-to-r from-primary-gold to-yellow-500",
    inactive: "text-primary-gold/30"
  }
};

// Icon sets with different themes
const iconSets = {
  business: [
    // Strategy
    "M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18",
    // Growth
    "M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941",
    // Success
    "M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z",
    // Target
    "M15 10.5a3 3 0 11-6 0 3 3 0 016 0z M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z",
    // Innovation  
    "M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"
  ],
  tech: [
    // Code
    "M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5",
    // Database
    "M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125",
    // Settings
    "M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z",
    // Analytics
    "M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z",
    // AI/Lightning
    "M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"
  ],
  achievement: [
    // Trophy
    "M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.544.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0",
    // Medal
    "M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.544.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0",
    // Star
    "M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z",
    // Badge
    "M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z",
    // Rocket
    "M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.631 8.41m5.96 5.96a14.926 14.926 0 01-5.841 2.58m-.119-8.54a6 6 0 00-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 00-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 01-2.448-2.448 14.9 14.9 0 01.06-.312m-2.24 2.39a4.493 4.493 0 00-1.757 4.306 4.493 4.493 0 004.306-1.758M16.5 9a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"
  ],
  custom: customIcons
};

// Get the appropriate icon set
const selectedIcons = iconSets[iconSet] || iconSets.business;

// Generate unique ID for this component instance
const componentId = `feature-icons-${Math.random().toString(36).substr(2, 9)}`;

console.log(`ðŸ”¥ FeatureIcons v1.0 rendered - ${normalizedCount}/${maxCount} icons, ${theme} theme, ${animationType} animation`);
---

<div 
  class={`feature-icons-container flex items-center justify-center space-x-2 ${className}`}
  id={componentId}
  data-count={normalizedCount}
  data-max-count={maxCount}
  data-animation={animationType}
  data-stagger-delay={staggerDelay}
  role="img"
  aria-label={`${normalizedCount} von ${maxCount} Features aktiv`}
>
  {selectedIcons.slice(0, maxCount).map((iconPath, index) => {
    const isActive = index < normalizedCount;
    const delay = index * staggerDelay;
    
    return (
      <div 
        class={`feature-icon transition-all duration-300 ${isActive ? 'active' : 'inactive'}`}
        data-index={index}
        data-delay={delay}
        style={`--animation-delay: ${delay}ms`}
        role="presentation"
        aria-hidden="true"
      >
        {variant === "filled" ? (
          <div class={`${sizeMap[size]} rounded-full flex items-center justify-center ${isActive ? 'bg-current' : 'bg-current opacity-30'}`}>
            <svg 
              xmlns="http://www.w3.org/2000/svg" 
              fill="white"
              viewBox="0 0 24 24" 
              class={`${sizeMap[size.replace(/w-|h-/g, '').replace(/\d+/, (n) => String(Math.max(3, parseInt(n) - 2)))}`}
            >
              <path d={iconPath} />
            </svg>
          </div>
        ) : (
          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            fill={variant === "default" && isActive ? "currentColor" : "none"}
            viewBox="0 0 24 24" 
            stroke-width={variant === "minimal" ? "1" : "1.5"}
            stroke="currentColor" 
            class={`${sizeMap[size]} ${isActive ? themes[theme].active : themes[theme].inactive}`}
          >
            <path 
              stroke-linecap="round" 
              stroke-linejoin="round" 
              d={iconPath} 
            />
          </svg>
        )}
      </div>
    );
  })}
  
  <!-- Screen Reader Summary -->
  <span class="sr-only">
    {normalizedCount} von {maxCount} Features sind aktiv
  </span>
</div>

<style>
  /* Base styles for feature icons */
  .feature-icon {
    transform-origin: center;
    will-change: transform, opacity;
  }
  
  /* Animation variants */
  .feature-icon.active[data-animation="bounce"] {
    animation: icon-bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
    animation-delay: var(--animation-delay);
  }
  
  .feature-icon.active[data-animation="fade"] {
    animation: icon-fade 0.5s ease-out forwards;
    animation-delay: var(--animation-delay);
  }
  
  .feature-icon.active[data-animation="scale"] {
    animation: icon-scale 0.4s ease-out forwards;
    animation-delay: var(--animation-delay);
  }
  
  .feature-icon.active[data-animation="slide"] {
    animation: icon-slide 0.5s ease-out forwards;
    animation-delay: var(--animation-delay);
  }
  
  .feature-icon.inactive {
    opacity: 0.3;
    transform: translateY(4px) scale(0.9);
  }
  
  /* Animation keyframes */
  @keyframes icon-bounce {
    0% {
      transform: translateY(8px) scale(0.8);
      opacity: 0.3;
    }
    50% {
      transform: translateY(-6px) scale(1.15);
      opacity: 0.8;
    }
    100% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }
  
  @keyframes icon-fade {
    0% {
      opacity: 0.3;
      transform: scale(0.8);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  @keyframes icon-scale {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    60% {
      transform: scale(1.2);
      opacity: 0.8;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  @keyframes icon-slide {
    0% {
      transform: translateX(-20px);
      opacity: 0;
    }
    100% {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  /* Hover effects */
  .feature-icons-container:hover .feature-icon.active {
    transform: scale(1.1);
    transition: transform 0.2s ease;
  }
  
  .feature-icon.active:hover {
    transform: scale(1.2) !important;
    transition: transform 0.2s ease !important;
  }
  
  /* Screen reader only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .feature-icon.active {
      color: currentColor !important;
      opacity: 1;
    }
    
    .feature-icon.inactive {
      opacity: 0.7;
      color: currentColor;
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .feature-icon {
      animation: none !important;
    }
    
    .feature-icon.active {
      opacity: 1;
      transform: none;
    }
    
    .feature-icon.inactive {
      opacity: 0.5;
      transform: none;
    }
  }
  
  /* Print styles */
  @media print {
    .feature-icon {
      color: black !important;
      opacity: 1 !important;
    }
    
    .feature-icon.inactive {
      opacity: 0.5 !important;
    }
  }
  
  /* Dark mode enhancements */
  @media (prefers-color-scheme: dark) {
    .feature-icon.active {
      filter: brightness(1.1);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('ðŸ”¥ FeatureIcons v1.0 animations initialized');
    
    // Enhanced intersection observer for better performance
    const observerOptions = {
      threshold: 0.3,
      rootMargin: '50px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const container = entry.target;
          const icons = container.querySelectorAll('.feature-icon.active');
          const animationType = container.getAttribute('data-animation') || 'bounce';
          const staggerDelay = parseInt(container.getAttribute('data-stagger-delay') || '100', 10);
          
          // Reset and restart animations
          icons.forEach((icon, index) => {
            // Reset animation
            icon.style.animation = 'none';
            
            // Force reflow
            void icon.offsetWidth;
            
            // Calculate staggered delay
            const delay = index * staggerDelay;
            icon.style.setProperty('--animation-delay', `${delay}ms`);
            
            // Apply animation based on type
            const duration = animationType === 'scale' ? '0.4s' : 
                           animationType === 'fade' ? '0.5s' : '0.6s';
            const easing = animationType === 'bounce' ? 'cubic-bezier(0.68, -0.55, 0.265, 1.55)' : 'ease-out';
            
            // Set animation attribute for CSS
            icon.setAttribute('data-animation', animationType);
            
            // Restart animation
            requestAnimationFrame(() => {
              icon.style.animation = `icon-${animationType} ${duration} ${easing} forwards ${delay}ms`;
            });
          });
          
          // Unobserve after first trigger for performance
          observer.unobserve(container);
        }
      });
    }, observerOptions);
    
    // Observe all feature icon containers
    document.querySelectorAll('.feature-icons-container').forEach(container => {
      observer.observe(container);
    });
    
    // Optional: Re-observe on window resize for dynamic content
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        // Re-observe containers if needed
        document.querySelectorAll('.feature-icons-container').forEach(container => {
          if (!container.getAttribute('data-observed')) {
            observer.observe(container);
            container.setAttribute('data-observed', 'true');
          }
        });
      }, 250);
    });
  });
</script>