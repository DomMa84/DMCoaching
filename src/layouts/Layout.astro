---
// src/layouts/Layout.astro v2.2 (FIXED: Textsichtbarkeit-Problem behoben)
// Main Layout - Premium Performance & Accessibility

import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CookieConsent from '../components/CookieConsent.astro';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  keywords?: string;
  ogImage?: string;
  ogType?: "website" | "article" | "product" | "profile";
  canonicalURL?: string;
  structuredData?: object;
  noIndex?: boolean;
  alternateLanguages?: { href: string; hreflang: string }[];
  breadcrumbs?: { name: string; url: string }[];
  lastModified?: string;
  priority?: "high" | "normal" | "low";
  businessHours?: string;
}

const { 
  title = "Dominik Maier | Strategische Unternehmensentwicklung & Value Management Baden-W√ºrttemberg",
  description = "‚úÖ Experte f√ºr Unternehmensentwicklung mit 15+ Jahren Erfahrung. Wertanalytiker VDI f√ºr nachhaltige Kostensenkung & Prozessoptimierung in Baden-W√ºrttemberg. Jetzt kostenloses Erstgespr√§ch vereinbaren!",
  keywords = "Unternehmensentwicklung Baden-W√ºrttemberg, Value Management, Wertanalytiker VDI, Vertriebsoptimierung, Interim Management, Business Coaching, Prozessoptimierung, Marketing Strategien, Schwarzwald, Bad Rippoldsau",
  ogImage = "/images/Dominik Maier - Portrait.jpeg",
  ogType = "website",
  canonicalURL,
  structuredData,
  noIndex = false,
  alternateLanguages = [],
  breadcrumbs = [],
  lastModified,
  priority = "normal",
  businessHours = "Mo-Fr 09:00-18:00"
} = Astro.props;

const url = canonicalURL || new URL(Astro.url.pathname, Astro.site);
const ogImageUrl = new URL(ogImage, Astro.site);

const enhancedTitle = title.length < 60 ? 
  `${title} | Professionelle Beratung` : 
  title;

const robotsContent = noIndex ? 
  "noindex, nofollow" : 
  priority === "high" ? 
    "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" :
    "index, follow";

console.log(`üé® Layout v2.2 loaded - Text Visibility FIXED, Title: ${title.substring(0, 50)}..., Priority: ${priority}`);
---

<!doctype html>
<html 
  lang="de" 
  itemscope 
  itemtype="https://schema.org/WebPage"
  prefix="og: http://ogp.me/ns#"
  class="scroll-smooth"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <!-- Enhanced Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Generator & Build Info -->
    <meta name="generator" content={Astro.generator} />
    <meta name="build-date" content={new Date().toISOString()} />
    {lastModified && <meta name="last-modified" content={lastModified} />}
    
    <!-- Core SEO Meta Tags -->
    <title>{enhancedTitle}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <link rel="canonical" href={url} />
    
    <!-- Robots & Indexing -->
    <meta name="robots" content={robotsContent} />
    <meta name="googlebot" content={robotsContent} />
    <meta name="bingbot" content={robotsContent} />
    
    <!-- Open Graph / Facebook Enhanced -->
    <meta property="og:type" content={ogType} />
    <meta property="og:site_name" content="Dominik Maier Coaching & Interim Management" />
    <meta property="og:url" content={url} />
    <meta property="og:title" content={enhancedTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:secure_url" content={ogImageUrl} />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={`${title} - Dominik Maier Unternehmensberatung`} />
    <meta property="og:locale" content="de_DE" />
    
    <!-- Twitter / X Enhanced -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={url} />
    <meta name="twitter:title" content={enhancedTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />
    <meta name="twitter:image:alt" content={`${title} - Dominik Maier`} />
    
    <!-- Enhanced Business & Local SEO -->
    <meta name="author" content="Dominik Maier, Wertanalytiker VDI" />
    <meta name="publisher" content="Dominik Maier Coaching & Interim Management" />
    <meta name="copyright" content="¬© 2025 Dominik Maier. Alle Rechte vorbehalten." />
    
    <!-- Geographic & Location SEO -->
    <meta name="geo.region" content="DE-BW" />
    <meta name="geo.placename" content="Bad Rippoldsau-Schapbach, Baden-W√ºrttemberg" />
    <meta name="geo.position" content="48.4331;8.3286" />
    <meta name="ICBM" content="48.4331, 8.3286" />
    
    <!-- Mobile & PWA Optimizations -->
    <meta name="theme-color" content="#D2AE6C" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#D2AE6C" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1a1a1a" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Dominik Maier" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    
    <!-- Enhanced Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    
    <!-- Critical CSS Fonts mit optimaler Performance -->
    <link 
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" 
      rel="stylesheet"
    />
    
    <!-- AOS Animation Library -->
    <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" 
      integrity="sha512-1cK78a1o+ht2JcaW6g8OXYwqpev9+6GqOkz9xmBN9iUUhIndKtxwILGWYOSibOKjLsEdjyjZvYDq/cZwNeak0w==" 
      crossorigin="anonymous" 
      referrerpolicy="no-referrer"
    />
    
    <!-- Enhanced Structured Data -->
    {structuredData && (
      <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
    )}
    
    <!-- Comprehensive Website Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebSite",
          "@id": "https://maier-value.com/#website",
          "url": "https://maier-value.com",
          "name": "Dominik Maier Coaching & Interim Management",
          "description": "Strategische Unternehmensentwicklung und Value Management f√ºr nachhaltigen Unternehmenserfolg in Baden-W√ºrttemberg",
          "publisher": {
            "@id": "https://maier-value.com/#organization"
          },
          "inLanguage": "de-DE"
        },
        {
          "@type": "Organization",
          "@id": "https://maier-value.com/#organization",
          "name": "Dominik Maier Coaching & Interim Management",
          "url": "https://maier-value.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://maier-value.com/logo.svg",
            "width": 300,
            "height": 300
          },
          "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+49-7440-913367",
            "email": "webmaster@maier-value.com",
            "contactType": "customer service",
            "availableLanguage": "German",
            "hoursAvailable": {
              "@type": "OpeningHoursSpecification",
              "dayOfWeek": [
                "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"
              ],
              "opens": "09:00",
              "closes": "18:00"
            }
          },
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Gaisbachweg 4",
            "addressLocality": "Bad Rippoldsau-Schapbach",
            "addressRegion": "Baden-W√ºrttemberg", 
            "postalCode": "77776",
            "addressCountry": "DE"
          },
          "geo": {
            "@type": "GeoCoordinates",
            "latitude": 48.4331,
            "longitude": 8.3286
          },
          "founder": {
            "@type": "Person",
            "name": "Dominik Maier",
            "jobTitle": "Wertanalytiker VDI & Unternehmensberater"
          },
          "areaServed": {
            "@type": "State",
            "name": "Baden-W√ºrttemberg"
          }
        }
      ]
    }
    </script>
    
    <!-- Enhanced Cookie-Consent Analytics -->
    <script is:inline>
      function loadGoogleAnalytics() {
        const consent = localStorage.getItem('cookie-consent');
        if (consent === 'accept' || consent === 'essential') {
          
          const gaScript = document.createElement('script');
          gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-08H9EG15DE';
          gaScript.async = true;
          document.head.appendChild(gaScript);
          
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-08H9EG15DE', {
            'anonymize_ip': true,
            'respect_dnt': true,
            'send_page_view': true
          });
          
          console.log('üìä Google Analytics 4 loaded with GDPR compliance');
        }
      }
      
      loadGoogleAnalytics();
      window.addEventListener('cookieConsentAccepted', loadGoogleAnalytics);
    </script>
    
    <!-- Enhanced Theme System -->
    <script is:inline>
      function applyTheme(theme) {
        document.documentElement.classList.toggle('dark', theme === 'dark');
        
        const themeColors = {
          light: '#D2AE6C',
          dark: '#1a1a1a'
        };
        
        document.querySelector('meta[name="theme-color"]').content = themeColors[theme];
        
        window.dispatchEvent(new CustomEvent('themeChanged', {
          detail: { theme }
        }));
      }
      
      const userTheme = localStorage.getItem('theme');
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      const activeTheme = userTheme || systemTheme;
      
      applyTheme(activeTheme);
      console.log('üé® Theme system initialized:', activeTheme);
    </script>
  </head>

  <!-- ‚úÖ FIXED: Korrigierte Tailwind-Klassen f√ºr Textsichtbarkeit -->
  <body class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans antialiased">
    <!-- Enhanced Skip Links -->
    <div class="sr-only">
      <a href="#main-content" class="fixed top-4 left-4 bg-gold text-white px-4 py-2 rounded-md z-50 font-medium focus:not-sr-only">
        Zum Hauptinhalt springen
      </a>
      <a href="#navigation" class="fixed top-4 left-32 bg-gold text-white px-4 py-2 rounded-md z-50 font-medium focus:not-sr-only">
        Zur Navigation springen
      </a>
    </div>
    
    <!-- Breadcrumbs -->
    {breadcrumbs.length > 0 && (
      <nav aria-label="Breadcrumb" class="bg-gray-50 dark:bg-gray-800 py-2">
        <div class="container mx-auto px-4">
          <ol class="flex items-center space-x-2 text-sm">
            <li>
              <a href="/" class="text-gold hover:underline">Home</a>
            </li>
            {breadcrumbs.map((crumb, index) => (
              <li class="flex items-center">
                <svg class="w-4 h-4 text-gray-400 mx-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
                {index === breadcrumbs.length - 1 ? (
                  <span class="text-gray-700 dark:text-gray-300" aria-current="page">{crumb.name}</span>
                ) : (
                  <a href={crumb.url} class="text-gold hover:underline">{crumb.name}</a>
                )}
              </li>
            ))}
          </ol>
        </div>
      </nav>
    )}
    
    <Header />
    
    <main id="main-content" class="flex-grow" role="main" itemscope itemtype="https://schema.org/WebPageElement">
      <slot />
    </main>
    
    <Footer />
    <CookieConsent />
    
    <!-- Enhanced AOS Initialization -->
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          if (typeof window.AOS === 'undefined') {
            const AOSModule = await import('https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js');
            window.AOS = AOSModule.default || AOSModule;
          }
          
          window.AOS.init({
            duration: 800,
            easing: 'ease-out-cubic',
            once: true,
            offset: 50,
            delay: 100,
            disable: window.matchMedia('(prefers-reduced-motion: reduce)').matches
          });
          
          console.log('üé¨ AOS animations initialized');
          
        } catch (error) {
          console.warn('‚ö†Ô∏è AOS initialization failed:', error);
        }
      });
    </script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(() => console.log('‚úÖ ServiceWorker registered'))
            .catch((error) => console.log('‚ùå ServiceWorker failed:', error));
        });
      }
    </script>
  </body>
</html>

<style is:global>
  :root {
    --gold: #D2AE6C;
    --gold-dark: #B8941A;
    --header-height: 80px;
  }
  
  html {
    scroll-behavior: smooth;
    scroll-padding-top: var(--header-height);
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
  }
  
  body {
    line-height: 1.6;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* ‚úÖ EMERGENCY TEXT VISIBILITY - Falls Tailwind versagt */
  body {
    color: #1f2937 !important;
    background-color: #ffffff !important;
  }
  
  .dark body {
    color: #f9fafb !important;
    background-color: #111827 !important;
  }
  
  /* Enhanced Accessibility */
  .sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
  
  .focus\:not-sr-only:focus {
    position: static !important;
    width: auto !important;
    height: auto !important;
    padding: 0.5rem 1rem !important;
    margin: 0 !important;
    overflow: visible !important;
    clip: auto !important;
    white-space: normal !important;
  }
  
  /* Enhanced Focus Styles */
  *:focus {
    outline: 2px solid var(--gold);
    outline-offset: 2px;
    border-radius: 0.125rem;
  }
  
  *:focus:not(:focus-visible) {
    outline: none;
  }
  
  *:focus-visible {
    outline: 2px solid var(--gold);
    outline-offset: 2px;
  }
  
  /* Gold Color Utility */
  .text-gold {
    color: var(--gold) !important;
  }
  
  .bg-gold {
    background-color: var(--gold) !important;
  }
  
  .border-gold {
    border-color: var(--gold) !important;
  }
  
  .hover\:bg-gold:hover {
    background-color: var(--gold) !important;
  }
  
  .hover\:text-gold:hover {
    color: var(--gold) !important;
  }
  
  /* Typography Enhancements */
  h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    line-height: 1.2;
    color: inherit;
  }
  
  p {
    margin-bottom: 1rem;
    color: inherit;
  }
  
  /* Link Enhancements */
  a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  a:hover {
    color: var(--gold);
    text-decoration: underline;
  }
  
  /* Button Enhancements */
  button {
    cursor: pointer;
    border-radius: 0.375rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    outline: none;
  }
  
  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  /* Form Enhancements */
  input, textarea, select {
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    border-radius: 0.375rem;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    background-color: #ffffff;
    color: #1f2937;
  }
  
  .dark input, .dark textarea, .dark select {
    background-color: #374151;
    border-color: #6b7280;
    color: #f9fafb;
  }
  
  input:focus, textarea:focus, select:focus {
    border-color: var(--gold);
    box-shadow: 0 0 0 3px rgba(210, 174, 108, 0.1);
    outline: none;
  }
  
  /* Smooth Theme Transitions */
  *,
  *::before,
  *::after {
    transition: background-color 0.3s ease, 
                color 0.3s ease, 
                border-color 0.3s ease;
  }
  
  /* Scrollbar Styling */
  ::-webkit-scrollbar {
    width: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  
  .dark ::-webkit-scrollbar-track {
    background: #374151;
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--gold);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: var(--gold-dark);
  }
  
  /* Reduced Motion Preferences */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
  
  /* Print Styles */
  @media print {
    * {
      background: white !important;
      color: black !important;
      box-shadow: none !important;
    }
    
    .no-print, nav, header, footer {
      display: none !important;
    }
  }
</style>